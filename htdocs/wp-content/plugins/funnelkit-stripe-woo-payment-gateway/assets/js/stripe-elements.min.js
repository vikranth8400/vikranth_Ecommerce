"use strict";function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var i={},e=Object.prototype,c=e.hasOwnProperty,t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",a=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a,o,i,s,t=t&&t.prototype instanceof h?t:h,t=Object.create(t.prototype),n=new v(n||[]);return t._invoke=(a=e,o=r,i=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return b()}for(i.method=e,i.arg=t;;){var r=i.delegate;if(r){r=function e(t,r){var n=t.iterator[r.method];if(void 0===n){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method))return u;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}n=l(n,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,u;n=n.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,u):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,u)}(r,i);if(r){if(r===u)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===s)throw s="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s="executing";r=l(a,o,i);if("normal"===r.type){if(s=i.done?"completed":"suspendedYield",r.arg===u)continue;return{value:r.arg,done:i.done}}"throw"===r.type&&(s="completed",i.method="throw",i.arg=r.arg)}}),t}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}i.wrap=s;var u={};function h(){}function d(){}function f(){}var t={},p=(o(t,n,function(){return this}),Object.getPrototypeOf),p=p&&p(p(k([]))),m=(p&&p!==e&&c.call(p,n)&&(t=p),f.prototype=h.prototype=Object.create(t));function y(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function _(i,s){var t;this._invoke=function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,a){var o,e=l(i[e],i,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==_typeof(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,a)},function(e){t("throw",e,n,a)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,a)});a(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function g(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function v(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function k(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:b}}function b(){return{value:void 0,done:!0}}return o(m,"constructor",d.prototype=f),o(f,"constructor",d),d.displayName=o(f,a,"GeneratorFunction"),i.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},i.awrap=function(e){return{__await:e}},y(_.prototype),o(_.prototype,r,function(){return this}),i.AsyncIterator=_,i.async=function(e,t,r,n,a){void 0===a&&(a=Promise);var o=new _(s(e,t,r,n),a);return i.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},y(m),o(m,a,"Generator"),o(m,n,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),i.keys=function(r){var e,n=[];for(e in r)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},i.values=k,v.prototype={constructor:v,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(g),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],o=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var i=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(i&&s){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}var o=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),g(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,a=this.tryEntries[t];if(a.tryLoc===e)return"throw"===(r=a.completion).type&&(n=r.arg,g(a)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},i}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=s.apply(e,i);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}jQuery(function(s){var o=fkwcs_data.common_style,i=s("form.woocommerce-checkout"),c=fkwcs_data.get_home_url,r=fkwcs_data.stripe_localized;function l(e,t){return null!==r[e]&&void 0!==r[e]?r[e]:t}var e=function(){function r(e,t){_classCallCheck(this,r),this.gateway_id=t,this.error_container=".fkwcs-credit-card-error",this.gateway_container="",this.stripe=e,this.mode="test",this.fragments={},this.setup_ready=!1,this.mountable=!1,this.element_type="",this.prepareStripe()}var e;return _createClass(r,[{key:"prepareStripe",value:function(){this.elements=this.stripe.elements({appearance:this.getAppearance()}),this.setupGateway(),this.wc_events()}},{key:"getAppearance",value:function(){return{}}},{key:"wc_events",value:function(){var r=this,n=s("input[name='wc-".concat(r.gateway_id,"-payment-token']:checked")),e=s("form#add_payment_method"),e=(s("form.checkout").on("checkout_place_order_"+this.gateway_id,this.processingSubmit.bind(this)),0<s("form#order_review").length&&(s("form#order_review").on("submit",this.processOrderReview.bind(this)),i=s("form#order_review")),0<e.length&&(e.on("submit",this.add_payment_method.bind(this)),i=e),s("#createaccount").on("change",function(){s(this).is(":checked")?s("#fkwcs-save-cc-fieldset").show():s("#fkwcs-save-cc-fieldset").hide()}),s(document.body).on("change",'input[name="payment_method"]',function(){r.showError(),r.gateway_id===s(this).val()&&r.resetGateway()}),s(document.body).on("updated_checkout",function(e,t){r.gateway_id===r.selectedGateway()&&(n.trigger("change"),r.mountGateway()),null!=t&&r.update_fragment_data(t.fragments)}),"complete"===document.readyState||"loading"===document.readyState?s(document).ready(function(){r.gateway_id===r.selectedGateway()&&r.mountGateway(),r.ready()}):s(window).on("load",function(){r.gateway_id===r.selectedGateway()&&r.mountGateway(),r.ready()}),s("#payment_method_"+this.gateway_id));0<e.length&&e.is(":checked")&&r.fastRender(),s(window).on("fkwcs_on_hash_change",this.onHashChange.bind(this)),s(document.body).on("change","input[name='wc-".concat(this.gateway_id,"-payment-token']"),function(){"new"!==s(this).val()?r.hideGatewayContainer():r.showGatewayContainer()}),n.trigger("change"),s(document).on("checkout_error",function(){var e=s(".fkwcs_source");0<e.length&&e.remove()}),s(document.body).trigger("wc-credit-card-form-init")}},{key:"ready",value:function(){}},{key:"fastRender",value:function(){}},{key:"setupGateway",value:function(){}},{key:"resetGateway",value:function(){}},{key:"mountGateway",value:function(){}},{key:"createSource",value:function(){}},{key:"processingSubmit",value:function(e){}},{key:"processOrderReview",value:function(e){}},{key:"add_payment_method",value:function(e){}},{key:"hideGatewayContainer",value:function(){0<s(this.gateway_container).length&&s(this.gateway_container).hide()}},{key:"showGatewayContainer",value:function(){0<s(this.gateway_container).length&&s(this.gateway_container).show()}},{key:"get_fragment_data",value:function(){return this.fragments}},{key:"update_fragment_data",value:function(e){this.fragments=e}},{key:"appendMethodId",value:function(e){var t=s(".fkwcs_source");0<t.length&&t.remove(),i.append("<input type='hidden' name='fkwcs_source' class='fkwcs_source' value='".concat(e,"'>"))}},{key:"getAddress",value:function(){var e=document.getElementById("billing_country"),t=document.getElementById("billing_postcode"),r=document.getElementById("billing_city"),n=document.getElementById("billing_state"),a=document.getElementById("billing_address_1"),o=document.getElementById("billing_address_2");return{country:null!==e?e.value:"",city:null!==r?r.value:"",postal_code:null!==t?t.value:"",state:null!==n?n.value:"",line1:null!==a?a.value:"",line2:null!==o?o.value:""}}},{key:"getBillingAddress",value:function(e){var t,r,n;return 0<s("form#order_review").length?fkwcs_data.current_user_billing:void 0!==_typeof(e)&&"add_payment"===e?{}:(e=document.getElementById("billing_first_name"),t=document.getElementById("billing_last_name"),r=document.getElementById("billing_email"),n=document.getElementById("billing_phone"),{name:(null!==e?e.value:"")+" "+(null!==t?t.value:""),email:null!==r?r.value:"",phone:null!==n?n.value:"",address:this.getAddress()})}},{key:"selectedGateway",value:function(){var e=s('input[name="payment_method"]:checked');return 0<e.length?e.val():""}},{key:"confirmStripePayment",value:function(e,t,r){console.log("Please override in child class")}},{key:"onHashChange",value:function(e,t){var r=t[1],n=t[2],a=decodeURIComponent(t[3]),o=decodeURIComponent(t[4]),i=decodeURIComponent(t[5]),t=decodeURIComponent(t[6]);this.gateway_id===i&&this.confirmStripePayment(n,a,r,o,t)}},{key:"showError",value:function(e){i.removeClass("processing"),this.unblockElement(),e?s(this.error_container).html(e.message):s(this.error_container).html("")}},{key:"showNotice",value:function(e){if("object"===_typeof(e)){if("validation_error"===e.type)return i.removeClass("processing"),void this.unblockElement();e=e.message}i.removeClass("processing"),s(".woocommerce-error").remove(),s(".woocommerce-notices-wrapper").eq(0).html('<div class="woocommerce-error fkwcs-errors">'+e+"</div>").show(),this.unblockElement(),e=".woocommerce-notices-wrapper",0!==jQuery(e).length&&jQuery("html, body").animate({scrollTop:jQuery(e).offset().top},500)}},{key:"unblockElement",value:function(){s("form.woocommerce-checkout").unblock(),s("form#order_review").unblock(),s("form#add_payment_method").unblock()}},{key:"logError",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=s("body");s.ajax({type:"POST",url:fkwcs_data.admin_ajax,data:{action:"fkwcs_js_errors",_security:fkwcs_data.js_nonce,order_id:t,error:e},beforeSend:function(){r.css("cursor","progress")},success:function(e){if(!1===e.success)return e.message;r.css("cursor","default")},error:function(){r.css("cursor","default")}})}},{key:"createPaymentIntent",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("action","fkwcs_create_payment_intent"),t.append("fkwcs_nonce",fkwcs_data.fkwcs_nonce),e.next=5,fetch(fkwcs_data.admin_ajax,{method:"POST",cache:"no-cache",body:t});case 5:return t=e.sent,e.abrupt("return",t.json());case 7:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"getAmountCurrency",value:function(){var e,t=s("#".concat(this.gateway_id,"_payment_data"));return 0===t.length?{amount:0,currency:"USD"}:(e=t.data("amount"),t=t.data("currency"),{amount:parseFloat(e),currency:t.toUpperCase()})}},{key:"isAvailable",value:function(){return 0<s("#payment_method_".concat(this.gateway_id)).length}}]),r}(),t=function(){_inherits(n,e);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).mountable=!0,e.error_container=".fkwcs_stripe_".concat(t,"_error"),e.confirmCallBack="",e.current_amount=0,e.message_element=!1,e.element=null,e}return _createClass(n,[{key:"wc_events",value:function(){_get(_getPrototypeOf(n.prototype),"wc_events",this).call(this)}},{key:"getAppearance",value:function(){var e=s("li.wc_payment_method label"),t=e.css("font-family"),r=e.css("color"),n=e.css("font-weight"),a="14px";return{variables:{colorText:r,colorTextSecondary:"rgb(28, 198, 255)",fontSizeBase:a,fontSizeSm:a,fontSizeXs:a,fontSize2Xs:a,fontLineHeight:e.css("line-height"),spacingUnit:"10px",fontWeightMedium:n,fontFamily:t}}}},{key:"update_fragment_data",value:function(e){_get(_getPrototypeOf(n.prototype),"update_fragment_data",this).call(this,e),this.updateElements(e)}},{key:"updateElements",value:function(e){var t;e.hasOwnProperty("fkwcs_paylater_data")&&(t=e.fkwcs_paylater_data.amount,e=e.fkwcs_paylater_data.currency,t!==this.current_amount&&null!==this.element&&(this.element.update({currency:e.toUpperCase(),amount:t}),this.current_amount=t),!0===this.message_element)&&(this.unmount(),this.createMessage(t,e),this.mountGateway(!1))}},{key:"ready",value:function(){try{this.mountGateway()}catch(e){console.log("exception",e)}}},{key:"createMessage",value:function(e,t){this.isSupportedCountries()&&(this.element=this.elements.create("paymentMethodMessaging",{amount:e,currency:t.toUpperCase(),paymentMethodTypes:this.paymentMethodTypes(),countryCode:s("#billing_country").val()}))}},{key:"confirmStripePayment",value:function(e,t,r){var n=this;""!==this.confirmCallBack&&this.stripe.hasOwnProperty(this.confirmCallBack)&&this.gateway_id===this.selectedGateway()&&this.stripe[this.confirmCallBack](e,{payment_method:this.paymentMethods(),payment_method_options:this.paymentMethodOptions(),return_url:c+t}).then(function(e){e.error?n.showError(e.error):n.successResponse(e,t)}).catch(function(){n.showError("user cancelled")})}},{key:"paymentMethodTypes",value:function(){return[]}},{key:"paymentMethodOptions",value:function(){return{}}},{key:"paymentMethods",value:function(){return{billing_details:this.getBillingAddress()}}},{key:"unmount",value:function(){var e=s(".".concat(this.gateway_id,"_select"));null!==this.element&&""!==e.html()&&this.element.unmount()}},{key:"resetGateway",value:function(){!1!==this.mountable&&this.mountGateway()}},{key:"mountGateway",value:function(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];!1!==this.mountable&&null!=this.element&&0!==(e=s(".".concat(this.gateway_id,"_form"))).length&&(e.show(),e=".".concat(this.gateway_id,"_form .").concat(this.gateway_id,"_select"),0===s(e).children().length&&this.element.mount(e),s(e).css({backgroundColor:"#fff"}),!0===t)&&(e=this.getAmountCurrency(),this.element.update({currency:e.currency,amount:e.amount}))}},{key:"successResponse",value:function(e,t){var r=e.error,e=e.paymentIntent;r?(this.showError(r),this.logError(r,order_id),this.showNotice(l(r.code,r.message))):"succeeded"===e.status?window.location=t:e.status}},{key:"isSupportedCountries",value:function(){return!1}}]),n}(),n=function(){_inherits(a,e);var r=_createSuper(a);function a(e,t){return _classCallCheck(this,a),(e=r.call(this,e,t)).error_container=".fkwcs-credit-card-error",e.mountable=!0,e.payment_data={},e.element_data={},e}return _createClass(a,[{key:"setupGateway",value:function(){this.gateway_container=".fkwcs-stripe-elements-form","payment"===fkwcs_data.card_form_type?this.setupUPEGateway():this.isInlineGateway()?this.inLineFields():this.separateFields()}},{key:"isInlineGateway",value:function(){return"yes"===fkwcs_data.inline_cc}},{key:"inLineFields",value:function(){var r=this;this.card=this.elements.create("card",s.extend({style:fkwcs_data.inline_style,hidePostalCode:!0,iconStyle:"solid"},fkwcs_data.card_element_options)),this.card.on("change",function(e){var t=e.brand,e=e.error;r.showError(),e?r.showError(e):t&&(r.isAllowedBrand(t)&&"unknown"===t?(s(r.error_cotainer).html(""),r.showError()):r.showError({message:fkwcs_data.default_cards[t]+" "+fkwcs_data.not_allowed_string}))})}},{key:"separateFields",value:function(){var a=this,e=JSON.stringify(o),e=JSON.parse(e);delete e.base.padding,void 0!==e.base.iconColor&&delete e.base.iconColor,this.cardNumber=this.elements.create("cardNumber",s.extend({style:e},fkwcs_data.card_element_options)),this.cardExpiry=this.elements.create("cardExpiry",{style:e}),this.cardCvc=this.elements.create("cardCvc",{style:e}),this.cardNumber.on("change",function(e){var t=e.brand,e=e.error,r=s("#fkwcs-stripe-elements-wrapper .fkwcs-credit-card-number"),n=s(".fkwcs-stripe-elements-field");a.showError(),e?(r.addClass("haserror"),a.showError(e)):(r.removeClass("haserror"),fkwcs_data.assets_url,"unknown"===t?n.removeClass("fkwcs_brand"):t&&(a.isAllowedBrand(t)?0<r.length&&(fkwcs_data.assets_url,n.addClass("fkwcs_brand")):"unknown"===t?n.removeClass("fkwcs_brand"):s(".fkwcs-credit-card-error").html(fkwcs_data.default_cards[t]+" "+fkwcs_data.not_allowed_string)))}),this.cardExpiry.on("change",function(e){e=e.error;e?(s(".fkwcs-credit-expiry").addClass("haserror"),s(".fkwcs-credit-expiry-error").html(e.message)):s(".fkwcs-credit-expiry-error").html("").removeClass("haserror")}),this.cardCvc.on("change",function(e){e=e.error;e?(s(".fkwcs-credit-cvc-error").html(e.message),s(".fkwcs-credit-cvc").addClass("haserror")):s(".fkwcs-credit-cvc-error").html("").removeClass("haserror")})}},{key:"resetGateway",value:function(){"payment"===fkwcs_data.card_form_type?null!==this.payment&&this.payment.unmount():this.isInlineGateway()?null!==this.card&&this.card.unmount():null!==this.cardNumber&&(this.cardNumber.unmount(),this.cardExpiry.unmount(),this.cardCvc.unmount()),this.mountGateway()}},{key:"mountGateway",value:function(){"payment"===fkwcs_data.card_form_type?this.mountElements():this.mountCard()}},{key:"mountCard",value:function(){s(".fkwcs-stripe-elements-wrapper").show(),this.isInlineGateway()?s(".fkwcs-stripe-elements-wrapper .fkwcs-credit-card-field").html()||null===this.card||this.card.mount(".fkwcs-stripe-elements-wrapper .fkwcs-credit-card-field"):this.isInlineGateway()||null===this.cardNumber||(this.cardNumber.mount(".fkwcs-stripe-elements-wrapper .fkwcs-credit-card-number"),this.cardExpiry.mount(".fkwcs-stripe-elements-wrapper .fkwcs-credit-expiry"),this.cardCvc.mount(".fkwcs-stripe-elements-wrapper .fkwcs-credit-cvc"))}},{key:"getCardElement",value:function(){return this.isInlineGateway()?this.card:this.cardNumber}},{key:"createSource",value:function(e){var t=this;i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),"payment"===fkwcs_data.card_form_type?this.createUPESource(e):this.stripe.createPaymentMethod({type:"card",card:this.getCardElement(),billing_details:this.getBillingAddress(e)}).then(function(e){t.handleSourceResponse(e)})}},{key:"handleSourceResponse",value:function(e){e.error?this.showNotice(e.error):e.paymentMethod&&(this.appendMethodId(e.paymentMethod.id),s("form#order_review").length&&"yes"===fkwcs_data.is_change_payment_page?this.create_setup_intent(e.paymentMethod.id,s("form#order_review")):s("form#add_payment_method").length?this.create_setup_intent(e.paymentMethod.id,s("form#add_payment_method")):(0<s("form#order_review").length?s("form#order_review"):s("form.checkout")).trigger("submit"))}},{key:"create_setup_intent",value:function(r,n){var a=this,e={action:"fkwcs_create_setup_intent",fkwcs_nonce:fkwcs_data.fkwcs_nonce,fkwcs_source:r};s.ajax({type:"POST",dataType:"json",url:fkwcs_data.admin_ajax,data:e,beforeSend:function(){s("body").css("cursor","progress")},success:function(e){if("success"===e.status){var t=e.data.client_secret,t=a.stripe.confirmCardSetup(t,{payment_method:r});t.then(function(e){e.hasOwnProperty("error")?(n.unblock(),a.showNotice(e.error)):n.trigger("submit")}),t.catch(function(e){n.unblock(),console.log("error",e)})}else if(!1===e.status)return!1;s("body").css("cursor","default")},error:function(){s("body").css("cursor","default"),alert("Something went wrong!")}})}},{key:"confirmStripePayment",value:function(e,r,n){var a=this,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];"payment"===fkwcs_data.card_form_type&&"no"===(4<arguments.length&&void 0!==arguments[4]?arguments[4]:"no")?this.confirmStripePaymentEl(e,r,n,o):("si"===n?this.stripe.handleCardSetup(e,{}):this.stripe.confirmCardPayment(e,{})).then(function(e){var t;e.error?(a.showNotice(e.error),0<(t=s(".fkwcs_source")).length&&t.remove(),e.error.hasOwnProperty("type")&&"api_connection_error"===e.error.type||a.logError(e.error,o)):"requires_capture"!==(t=e["si"===n?"setupIntent":"paymentIntent"]).status&&"succeeded"!==t.status||(window.location=r)}).catch(function(e){s.get(r+"&is_ajax")})}},{key:"hasSource",value:function(){var e=s('input[name="wc-fkwcs_stripe-payment-token"]:checked');return 0<e.length&&"new"!==e.val()||0<(e=s(".fkwcs_source")).length?e.val():""}},{key:"processingSubmit",value:function(e){if(""===this.hasSource())return this.createSource("submit"),e.preventDefault(),!1}},{key:"processOrderReview",value:function(e){if(this.gateway_id===this.selectedGateway()&&""===this.hasSource())return this.createSource("order_review"),e.preventDefault(),!1}},{key:"add_payment_method",value:function(e){if(""===this.hasSource())return this.createSource("add_payment"),e.preventDefault(),!1}},{key:"onEarlyRenewalSubmit",value:function(e){var t=this;return e.preventDefault(),s.ajax({url:s("#early_renewal_modal_submit").attr("href"),method:"get",success:function(e){e=JSON.parse(e);e.fkwcs_stripe_sca_required?t.confirmStripePayment(e.intent_secret,e.redirect_url):window.location=e.redirect_url}}),!1}},{key:"isAllowedBrand",value:function(e){return 0!==fkwcs_data.allowed_cards.length&&-1!==s.inArray(e,fkwcs_data.allowed_cards)}},{key:"wc_events",value:function(){var e,t,r,n;_get(_getPrototypeOf(a.prototype),"wc_events",this).call(this),"yes"!==fkwcs_data.is_change_payment_page&&"yes"!==fkwcs_data.is_pay_for_order_page||!(n=null==(n=window.location.hash.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+):(.+):(.+):(.+)$/))?window.location.hash.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+)$/):n)||(e=n[1],t=n[2],r=decodeURIComponent(n[3]),n=decodeURIComponent(n[4]),this.confirmStripePayment(t,r,e,n)),(s("#early_renewal_modal_submit[data-payment-method]").length?s("#early_renewal_modal_submit[data-payment-method=fkwcs_stripe]"):s("#early_renewal_modal_submit")).on("click",this.onEarlyRenewalSubmit.bind(this)),s(document.body).on("change",".woocommerce-SavedPaymentMethods-tokenInput",function(){var e=s(this).attr("name"),t=s(".fkwcs-stripe-elements-wrapper");"wc-fkwcs_stripe-payment-token"!=e||"new"==s(this).val()?t.show():t.hide()})}},{key:"setupUPEGateway",value:function(){this.setup_ready=!0,this.payment_data=fkwcs_data.fkwcs_payment_data,this.element_data=this.payment_data.element_data,this.element_options=this.payment_data.element_options,this.createStripeElements()}},{key:"createStripeElements",value:function(){this.elements=this.stripe.elements(this.element_data),this.payment=this.elements.create("payment",this.element_options),this.payment.on("change",function(e){e.value.type}),this.link(this.elements)}},{key:"mountElements",value:function(){0===s(".fkwcs-stripe-payment-elements-field.StripeElement").length&&null!==this.payment&&this.payment.mount(".fkwcs-stripe-payment-elements-field")}},{key:"updatableElementKeys",value:function(){return["locale","mode","currency","amount","setup_future_usage","capture_method","payment_method_types","appearance","on_behalf_of"]}},{key:"update_fragment_data",value:function(e){_get(_getPrototypeOf(a.prototype),"update_fragment_data",this).call(this,e),this.updateElements()}},{key:"updateElements",value:function(){if("payment"===fkwcs_data.card_form_type){var e=this.get_fragment_data();if(!e.hasOwnProperty("fkwcs_payment_data"))return!1;this.payment_data=e.fkwcs_payment_data;var t=this.payment_data.element_data;if(JSON.stringify(t)!==JSON.stringify(this.element_data)){this.element_data=t;var r,n,a=this.updatableElementKeys();for(r in t)a.indexOf(r)<0||((n={})[r]=t[r],this.elements.update(n))}}}},{key:"createUPESource",value:function(e){var t=this;i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),this.elements.submit().then(function(e){t.stripe.createPaymentMethod({elements:t.elements,params:{billing_details:t.getBillingAddress()}}).then(function(e){e.error?"validation_error"!==e.error.type?t.showError(e.error):t.showError(!1):t.handleSourceResponse(e)}).catch(function(e){console.log("error",e)})})}},{key:"confirmStripePaymentEl",value:function(e,r,n){var a=this,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],e={elements:this.elements,clientSecret:e,confirmParams:{return_url:c+r},redirect:"if_required"};("si"===n?this.stripe.confirmSetup(e):this.stripe.confirmPayment(e)).then(function(e){var t;e.error?(a.showNotice(e.error),0<(t=s(".fkwcs_source")).length&&t.remove(),e.error.hasOwnProperty("type")&&"api_connection_error"===e.error.type||(a.logError(e.error,o),a.showError(e.error))):"requires_capture"!==(t=e["si"===n?"setupIntent":"paymentIntent"]).status&&"succeeded"!==t.status&&"processing"!==t.status||(window.location=r)}).then(function(e){e&&(a.showError(e),a.logError(e,o),a.showNotice(l(e.code,e.message)))})}},{key:"link",value:function(e){try{var t,r=this;"yes"===fkwcs_data.link_authentication&&"payment"===fkwcs_data.card_form_type&&(t=this.stripe.linkAutofillModal(e),s(document.body).on("keyup","#billing_email",function(){t.launch({email:s(this).val()})}),"yes"===fkwcs_data.link_authentication_page_load&&t.launch({email:s("#billing_email").val()}),t.on("autofill",function(e){var t=null==(t=e.value)?void 0:t.billingAddress,e=null==(e=e.value)?void 0:e.shippingAddress,e=(null===t&&null!==e&&(t=e),null===e&&null!==t&&(e=t),"object"==_typeof(t)&&null!=t&&r.prefillFields(t,"billing"),"object"==_typeof(e)&&null!=t&&r.prefillFields(e,"shipping"),s('[name="terms"]').prop("checked",!0),null!=(t=s("#wc-fkwcs_stripe-payment-token-new"))&&t.prop("checked",!0).trigger("change"),s("#payment_method_"+r.gateway_id));e.trigger("click"),e.trigger("change"),i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s("#place_order").trigger("click")},1e3)}))}catch(e){console.log(e)}}},{key:"prefillFields",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"billing",r=e.name,n=r.split(" "),a=n[0],n=(n=n.splice(0,1)).join(" "),o=s("#".concat(t,"_last_name")),i=s("#".concat(t,"_first_name")),r=(0===o.length?i.val(r):(i.val(a),o.val(n)),e.address),n=(null!=(i=s("#".concat(t,"_city")))&&i.val(r.city),null!=(a=s("#".concat(t,"_country")))&&a.val(r.country).trigger("change"),null!=(o=s("#".concat(t,"_postcode")))&&o.val(r.postal_code),s("#".concat(t,"_address_1"))),e=s("#".concat(t,"_address_2"));0<e.length?(n.val(r.line1),e.val(r.line2)):n.val(r.line1+" "+r.line2),setTimeout(function(e,t){var n=e.state,a=s("#".concat(t,"_state"));0<a.length&&(0<(e=a.find("option")).length?e.each(function(){var e=s(this).text(),t=s(this).val(),r=(n=n.toLowerCase(),e=e.toLowerCase(),t.toLowerCase());n!=e&&n!=r||a.val(t)}):a.val(n),a.trigger("change"))},2e3,r,t)}}]),a}(),a=function(){_inherits(n,e);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).selectedP24Bank="",e.error_container=".fkwcs_stripe_p24_error",e}return _createClass(n,[{key:"setupGateway",value:function(){var t=this;this.p24=this.elements.create("p24Bank",{style:o}),this.p24.on("change",function(e){t.selectedP24Bank=e.value,t.showError()})}},{key:"resetGateway",value:function(){this.p24.unmount(),this.mountGateway()}},{key:"mountGateway",value:function(){var e=s(".".concat(this.gateway_id,"_form"));0!==e.length&&(e.show(),e=".".concat(this.gateway_id,"_form .").concat(this.gateway_id,"_select"),this.p24.mount(e),s(e).css({backgroundColor:"#fff"}))}},{key:"processingSubmit",value:function(e){if(""===this.selectedP24Bank)return this.showError({message:fkwcs_data.empty_bank_message}),this.showNotice(fkwcs_data.empty_bank_message),!1;this.showError("")}},{key:"confirmStripePayment",value:function(e,t,r){this.gateway_id===this.selectedGateway()&&this.stripe.confirmP24Payment(e,{payment_method:{billing_details:this.getBillingAddress()},return_url:c+t})}}]),n}(),u=function(){_inherits(n,e);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).error_container=".fkwcs_stripe_sepa_error",e.sepaIBAN=!1,e.paymentMethod="",e.emptySepaIBANMessage=fkwcs_data.empty_sepa_iban_message,e}return _createClass(n,[{key:"setupGateway",value:function(){var t=this,r=this,e=(this.gateway_container=".fkwcs_stripe_sepa_payment_form",Object.keys(fkwcs_data.sepa_options).length?fkwcs_data.sepa_options:{});this.sepa=this.elements.create("iban",e),this.sepa.on("change",function(e){e=e.error;if(t.isSepaSaveCardChosen())return!0;e?(r.sepaIBAN=!1,r.emptySepaIBANMessage=e.message,r.showError(e),r.logError(e)):(t.sepaIBAN=!0,r.showError(""))}),this.setup_ready=!0}},{key:"resetGateway",value:function(){this.sepa.unmount(),this.mountGateway()}},{key:"mountGateway",value:function(){if(!1!==this.setup_ready){if(0===s(".payment_method_fkwcs_stripe_sepa").length)return!1;this.sepa.mount(".fkwcs_stripe_sepa_iban_element_field"),s(".fkwcs_stripe_sepa_payment_form .fkwcs_stripe_sepa_iban_element_field").css({backgroundColor:"#fff",borderRadius:"3px"})}}},{key:"isSepaSaveCardChosen",value:function(){return s("#payment_method_fkwcs_stripe_sepa").is(":checked")&&s('input[name="wc-fkwcs_stripe_sepa-payment-token"]').is(":checked")&&"new"!==s('input[name="wc-fkwcs_stripe_sepa-payment-token"]:checked').val()}},{key:"processingSubmit",value:function(e){if(""===this.paymentMethod&&!this.isSepaSaveCardChosen())return!1===this.sepaIBAN?this.showError(this.emptySepaIBANMessage):this.createPaymentMethod(),!1}},{key:"processOrderReview",value:function(e){if(this.gateway_id===this.selectedGateway()&&""===this.paymentMethod&&!this.isSepaSaveCardChosen())return this.createPaymentMethod(),!1}},{key:"createPaymentMethod",value:function(){var t=this;this.stripe.createPaymentMethod({type:"sepa_debit",sepa_debit:this.sepa,billing_details:this.getBillingAddress()}).then(function(e){e.error?(t.logError(e.error),t.showNotice(l(e.error.code,e.error.message))):e.paymentMethod&&(i.find(".fkwcs_payment_method").remove(),t.paymentMethod=e.paymentMethod.id,t.appendMethodId(t.paymentMethod),i.trigger("submit"))})}},{key:"confirmStripePayment",value:function(e,t,r){var n=this,a=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];this.gateway_id===this.selectedGateway()&&("si"===r?this.isSepaSaveCardChosen()||a?this.stripe.confirmSepaDebitSetup(e,{}).then(function(e){e.error?(n.logError(e.error,o),n.showNotice(l(e.error.code,e.error.message))):"succeeded"!==e.setupIntent.status&&"processing"!==e.setupIntent.status||(s(".woocommerce-error").remove(),window.location=t)}):this.stripe.confirmSepaDebitSetup(e,{payment_method:{sepa_debit:this.sepa,billing_details:this.getBillingAddress()}}).then(function(e){e.error?(n.logError(e.error),n.showNotice(l(e.error.code,e.error.message))):"succeeded"!==e.setupIntent.status&&"processing"!==e.setupIntent.status||(s(".woocommerce-error").remove(),window.location=t)}):this.isSepaSaveCardChosen()||a?this.stripe.confirmSepaDebitPayment(e,{}).then(function(e){e.error?(n.logError(e.error,o),n.showNotice(l(e.error.code,e.error.message))):"succeeded"!==e.paymentIntent.status&&"processing"!==e.paymentIntent.status||(s(".woocommerce-error").remove(),window.location=t)}):this.stripe.confirmSepaDebitPayment(e,{payment_method:{sepa_debit:this.sepa,billing_details:this.getBillingAddress()}}).then(function(e){e.error?(n.logError(e.error),n.showNotice(l(e.error.code,e.error.message))):"succeeded"!==e.paymentIntent.status&&"processing"!==e.paymentIntent.status||(s(".woocommerce-error").remove(),window.location=t)}))}}]),n}(),h=function(){_inherits(n,e);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).selectedIdealBank="",e.error_cotainer=".fkwcs_stripe_ideal_error",e}return _createClass(n,[{key:"setupGateway",value:function(){var t=this;this.ideal=this.elements.create("idealBank",{style:o}),this.ideal.on("change",function(e){t.selectedIdealBank=e.value,t.showError()})}},{key:"resetGateway",value:function(){this.ideal.unmount(".fkwcs_stripe_ideal_form .fkwcs_stripe_ideal_select"),this.mountGateway()}},{key:"mountGateway",value:function(){var e=s(".fkwcs_stripe_ideal_form");0!==e.length&&(e.show(),this.ideal.mount(".fkwcs_stripe_ideal_form .fkwcs_stripe_ideal_select"),s(".fkwcs_stripe_ideal_form .fkwcs_stripe_ideal_select").css({backgroundColor:"#fff"}))}},{key:"processingSubmit",value:function(e){if(""===this.selectedIdealBank)return this.showError({message:fkwcs_data.empty_bank_message}),this.showNotice(fkwcs_data.empty_bank_message),!1;this.showError()}},{key:"confirmStripePayment",value:function(e,t,r){var n,a=this,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];this.gateway_id===this.selectedGateway()&&(n=this.ideal,this.stripe.confirmIdealPayment(e,{payment_method:{ideal:n,billing_details:this.getBillingAddress()},return_url:c+t}).then(function(e){e.error&&(a.logError(e.error,o),a.showNotice(l(e.error.code,e.error.message)))}))}}]),n}(),d=function(){_inherits(n,t);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).error_container=".fkwcs_stripe_bancontact_error",e.confirmCallBack="confirmBancontactPayment",e}return _createClass(n,[{key:"confirmStripePayment",value:function(e,t,r){var n=this,a=4<arguments.length&&void 0!==arguments[4]&&arguments[4];this.gateway_id===this.selectedGateway()&&this.stripe.confirmBancontactPayment(e,{payment_method:{billing_details:this.getBillingAddress()},return_url:c+t}).then(function(e){e=e.error;e&&(n.showError(e),n.logError(e,a),n.showNotice(l(e.code,e.message)))})}}]),n}(),f=function(){_inherits(n,t);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).error_container=".fkwcs_stripe_affirm_error",e.confirmCallBack="confirmAffirmPayment",e.mountable=!0,e.message_element=!0,e}return _createClass(n,[{key:"setupGateway",value:function(){this.setup_ready=!0;var e=this.getAmountCurrency();this.createMessage(e.amount,e.currency)}},{key:"paymentMethodTypes",value:function(){return["affirm"]}},{key:"isSupportedCountries",value:function(){var e=s("#billing_country").val();return-1<["US","CA"].indexOf(e)}}]),n}(),p=function(){_inherits(n,t);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).error_container=".fkwcs_stripe_klarna_error",e.confirmCallBack="confirmKlarnaPayment",e.mountable=!0,e.message_element=!0,e}return _createClass(n,[{key:"setupGateway",value:function(){this.setup_ready=!0;var e=this.getAmountCurrency();this.createMessage(e.amount,e.currency)}},{key:"paymentMethodTypes",value:function(){return["klarna"]}},{key:"isSupportedCountries",value:function(){var e=s("#billing_country").val();return-1<["AU","CA","US","DK","NO","SE","GB","PL","CH","NZ","AT","BE","DE","ES","FI","FR","GR","IE","IT","NL","PT"].indexOf(e)}}]),n}(),m=function(){_inherits(n,t);var r=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=r.call(this,e,t)).error_container=".fkwcs_stripe_afterpay_error",e.confirmCallBack="confirmAfterpayClearpayPayment",e.mountable=!0,e.message_element=!0,e}return _createClass(n,[{key:"setupGateway",value:function(){this.setup_ready=!0;var e=this.getAmountCurrency();this.createMessage(e.amount,e.currency)}},{key:"paymentMethodTypes",value:function(){return["afterpay_clearpay"]}},{key:"isSupportedCountries",value:function(){var e=s("#billing_country").val();return-1<["US"].indexOf(e)}}]),n}();var y=fkwcs_data.pub_key,_=fkwcs_data.mode;if(""===y||"live"===_&&!fkwcs_data.is_ssl)console.log("Live Payment Mode only work only https protocol ");else{try{var w=["link_beta_2"],g=("yes"===fkwcs_data.link_authentication&&"payment"===fkwcs_data.card_form_type&&(w=["link_autofill_modal_beta_1"]),Stripe(y,{locale:fkwcs_data.locale,betas:w}));new n(g,"fkwcs_stripe"),new a(g,"fkwcs_stripe_p24"),new u(g,"fkwcs_stripe_sepa"),new h(g,"fkwcs_stripe_ideal"),new d(g,"fkwcs_stripe_bancontact"),new f(g,"fkwcs_stripe_affirm"),new p(g,"fkwcs_stripe_klarna"),new m(g,"fkwcs_stripe_afterpay")}catch(e){console.log(e)}window.addEventListener("hashchange",function(){var e=window.location.hash.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+):(.+):(.+):(.+)$/);!(e=null==e?window.location.hash.match(/^#?fkwcs-confirm-(pi|si)-([^:]+):(.+)$/):e)||e.length<4||(history.pushState({},"",window.location.pathname),s(window).trigger("fkwcs_on_hash_change",[e]))})}});